{ config, lib, pkgs, ... }:
let
  cfg = config.modules.pentest;
in
{
  config = lib.mkIf cfg.enable {
    programs.ghidra.enable = true;

    environment.systemPackages = with pkgs; [
      # Core tools
      netcat-gnu goose-cli imagemagick github-copilot-cli burpsuite
      binaryninja-free file solc awscli2 curlie python3 mariadb
      samba inetutils wireshark metasploit armitage
      python313Packages.impacket openvpn

      # Network & Reconnaissance
      nmap masscan rustscan amass subfinder nuclei fierce
      dnsenum theharvester responder netexec enum4linux-ng
      arp-scan nbtscan smbmap

      # Web Application Security
      gobuster feroxbuster ffuf dirb httpx katana nikto
      sqlmap wpscan arjun dalfox wafw00f testssl gau hakrawler
      whatweb commix wfuzz jwt-cli

      # Password & Authentication
      hydra john hashcat medusa evil-winrm hash-identifier ophcrack
      crunch

      # Binary Analysis & Reverse Engineering
      gdb radare2 binwalk checksec volatility3 foremost steghide exiftool
      pwntools one_gadget upx

      # Cloud & Container Security (for Hexstrike)
      prowler trivy kube-hunter

      # OSINT & Recon
      sherlock recon-ng

      # Python dependencies for Hexstrike MCP
      python313Packages.fastapi
      python313Packages.uvicorn
      python313Packages.aiohttp
      python313Packages.pydantic

      # Chrome/Chromium for Chrome DevTools MCP
      chromium
    ];
  };
}
